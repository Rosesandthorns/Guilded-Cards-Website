<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guilded Cards - Cards</title>
    <link rel="stylesheet" href="style.css">
    </head>
<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="cards.html">Cards</a>
            <a href="profile.html">Profile</a>
            <div id="gemTokenContainer" class="loading">
                <p><img src="Guildedicons/GuildedGem.png" alt="Gem Icon" class="currency-icon"> Gems: <span id="gems-count"></span><span class="loading-indicator">Loading...</span></p>
                <p><img src="Guildedicons/GuildedToken.png" alt="Token Icon" class="currency-icon"> Tokens: <span id="tokens-count"></span><span class="loading-indicator">Loading...</span></p>
            </div>
            <button id="googleSignInButton" class="loading">
                <span id="button-text">Sign in with Google</span>
                <span id="button-loading" class="loading-indicator">Loading...</span>
            </button>
        </nav>
    </header>
    <main>
        <h1>Welcome to Guilded Cards!</h1>
        <p>Explore and collect unique cards.</p>
        <div id="content"></div>
        <div id="card-packs-container">
           </div>
    </main>

    <script type="module" src="CoinGemUserData.js"></script>
    <script type="module">
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { displayUserStatsRealtime, stopListening } from "./CoinGemUserData.js";
        // Add import for Firebase Functions if you're using them (recommended):
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-functions.js';


        const auth = getAuth();
        const googleProvider = new GoogleAuthProvider();
        let unsubscribe;
        let unsubscribeStats;
        // Get the functions instance (if using Firebase Functions)
        const functions = getFunctions();

        // Function to handle Google Sign-In
        async function signInWithGoogle() {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                console.log("User signed in:", result.user);
            } catch (error) {
                console.error("Error signing in with Google:", error);
                // Consider showing an error message to the user here.
            }
        }

        // Function to handle Sign-Out
        async function signOutFromGoogle() {
            try {
                await signOut(auth);
                console.log("User signed out");
            } catch (error) {
                console.error("Error signing out:", error);
                // Consider showing an error message to the user here.
            }
        }

        // Example function (you'll need to implement this using your Firebase setup):

        async function openCardPack(packId) {
        // 1. Check if the user has enough tokens.
        // 2. Deduct a token from the user's balance.
        // 3. Call your Firebase function to get the cards for the pack.
        // 4. Return the cards.
        // 5. Handle errors (e.g., not enough tokens, pack not found).
        //    Make sure your Firebase function handles security (only authenticated users
        //    can open packs, etc.)

            const user = auth.currentUser;
            if (!user) {
            throw new Error("User not signed in."); // Or handle the unsigned-in state
            }

            const openPackFunction = httpsCallable(functions, 'openPack'); // Replace 'openPack'
            try{
                const result = await openPackFunction({ packId: packId, userId: user.uid });
                 return result.data; // Assuming your Cloud Function returns the cards in the 'data' field
            }
            catch(error){
                console.error("Error opening pack:", error);
                alert("Failed to open the pack. Please try again later."); // User-friendly error
                throw error; // Re-throw to handle it further up if needed

            }
        }

        const packsData = {
        "starter-pack": {
            name: "Starter Pack",
            image: "starter-pack-image.png", // Replace with actual image path
            price: 1, // 1 Token
            cards: [1, 2, 3, 17, 33, 34, 35], // Card IDs in this pack
        },
        "basics-pack": {
            name: "The Basics",
            image: "basics-pack-image.png", // Replace
            price: 3,
            cards: [1, 2, 3, 4, 5, 6],
        },
        "guild-wars-pack": {
            name: "Guild Wars",
            image: "guild-wars-pack-image.png", // Replace
            price: 5,
            cards: [10, 11, 12, 13, 17, 18, 19, 20, 21, 22, 34, 35, 36, 37, 38, 41],
        },
        "here-be-dragons-pack": {
            name: "Here be Dragons",
            image: "here-be-dragons-pack-image.png", // Replace
            price: 4,
            cards: [23, 24, 25, 26, 27, 28, 29, 33],
        },

    };

    const cardsData = {
        1: { name: "Shield Bug", rarity: "Starter", pack: "The Basics" },
        2: { name: "Stone Golem", rarity: "Starter", pack: "The Basics" },
        3: { name: "White Snow", rarity: "Starter", pack: "The Basics" },
        4: { name: "Void Bug", rarity: "Uncommon", pack: "The Basics" },
        5: { name: "Void Golem", rarity: "Uncommon", pack: "The Basics" },
        6: { name: "Black Snow", rarity: "Uncommon", pack: "The Basics" },
        10: { name: "Hesta the Merchant", rarity: "Rare", pack: "Guild Wars" },
        11: { name: "Golden Guard", rarity: "Rare", pack: "Guild Wars" },
        12: { name: "Golden Relic", rarity: "Elusive", pack: "Guild Wars" },
        13: { name: "Golden Crown", rarity: "Elusive", pack: "Guild Wars" },
        17: { name: "Mana Deposit", rarity: "Starter", pack: "Guild Wars" },
        18: { name: "Mad Mana", rarity: "Uncommon", pack: "Guild Wars" },
        19: { name: "Elder Gorsh", rarity: "Rare", pack: "Guild Wars" },
        20: { name: "Moro the Sniper", rarity: "Rare", pack: "Guild Wars" },
        21: { name: "Doomsday Device", rarity: "Elusive", pack: "Guild Wars" },
